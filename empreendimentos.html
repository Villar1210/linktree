{% extends "base.html" %}

{% block title %}Empreendimentos - Lumiar{% endblock %}

{% block content %}
<div class="container">
    <section class="page-header">
        <h1>üè† Nossos Empreendimentos</h1>
        <p>Encontre o im√≥vel dos seus sonhos</p>
    </section>

    <div class="filters">
        <button class="filter-btn active" data-filter="all">Todos</button>
        <button class="filter-btn" data-filter="Apartamento">Apartamentos</button>
        <button class="filter-btn" data-filter="Casa">Casas</button>
        <button class="filter-btn" data-filter="Cobertura">Coberturas</button>
    </div>

    <!-- Novo Empreendimento -->
    <div class="empreendimento-edit-form" id="novo-empreendimento-form" style="display: none; margin-bottom: 2rem;">
        <form method="POST" action="/admin/empreendimentos/adicionar">
            <div class="form-group">
                <label>Nome</label>
                <input type="text" name="nome" class="form-control" required>
            </div>
            <div class="form-group">
                <label>Tipo</label>
                <input type="text" name="tipo" class="form-control" required>
            </div>
            <div class="form-group">
                <label>Status</label>
                <input type="text" name="status" class="form-control" required>
            </div>
            <div class="form-group">
                <label>Localiza√ß√£o</label>
                <input type="text" name="localizacao" class="form-control" required>
            </div>
            <div class="form-group">
                <label>Quartos</label>
                <input type="number" name="quartos" class="form-control" required>
            </div>
            <div class="form-group">
                <label>Banheiros</label>
                <input type="number" name="banheiros" class="form-control" required>
            </div>
            <div class="form-group">
                <label>√Årea</label>
                <input type="text" name="area" class="form-control" required>
            </div>
            <div class="form-group">
                <label>Descri√ß√£o</label>
                <textarea name="descricao" class="form-control" rows="2"></textarea>
            </div>
            <div class="form-group">
                <label>Pre√ßo</label>
                <input type="text" name="preco" class="form-control" required>
            </div>
            <div class="form-group">
                <label>Imagem (URL)</label>
                <input type="text" name="imagem" class="form-control">
            </div>
            <div class="form-group">
                <label>Mensagem WhatsApp</label>
                <input type="text" name="whatsapp_message" class="form-control">
            </div>
            <div class="empreendimento-actions">
                <button type="submit" class="btn btn-primary btn-sm">Salvar</button>
                <button type="button" class="btn btn-outline btn-sm" onclick="cancelarNovoEmpreendimento()">Cancelar</button>
            </div>
        </form>
    </div>
    <button class="btn btn-sm btn-success" onclick="mostrarNovoEmpreendimento()" style="margin-bottom:1rem;">+ Novo Empreendimento</button>

    <div class="empreendimentos-grid">
        {% for emp in empreendimentos %}
        <div class="empreendimento-card" data-emp-id="{{ emp.id }}" data-tipo="{{ emp.tipo }}">
            <div class="card-image">
                <img src="{{ emp.imagem }}" alt="{{ emp.nome }}" onerror="this.src='/static/images/placeholder.jpg'">
                <div class="card-status status-{{ emp.status.lower().replace(' ', '-') }}">
                    {{ emp.status }}
                </div>
            </div>
            <div class="card-content empreendimento-view">
                <h3 class="card-title">{{ emp.nome }}</h3>
                <p class="card-location">üìç {{ emp.localizacao }}</p>
                <div class="card-details">
                    <span class="detail">üõèÔ∏è {{ emp.quartos }} quartos</span>
                    <span class="detail">üöø {{ emp.banheiros }} banheiros</span>
                    <span class="detail">üìê {{ emp.area }}</span>
                </div>
                <p class="card-description">{{ emp.descricao }}</p>
                <div class="card-footer">
                    <div class="card-price">{{ emp.preco }}</div>
                    <a href="{{ WHATSAPP_VENDAS|whatsapp_link(emp.whatsapp_message) }}" 
                       target="_blank" 
                       class="card-button">
                        üí¨ Tenho Interesse
                    </a>
                </div>
                <div class="empreendimento-actions">
                    <button class="btn btn-sm btn-outline" onclick="editarEmpreendimento({{ emp.id }})">Editar</button>
                    <button class="btn btn-sm btn-danger" onclick="deletarEmpreendimento({{ emp.id }})">Deletar</button>
                </div>
            </div>
            <!-- Edit Form (Hidden) -->
            <div class="empreendimento-edit-form" style="display: none;" data-emp-id="{{ emp.id }}">
                <form method="POST" action="/admin/empreendimentos/{{ emp.id }}/editar">
                    <div class="form-group">
                        <label>Nome</label>
                        <input type="text" name="nome" class="form-control" value="{{ emp.nome }}">
                    </div>
                    <div class="form-group">
                        <label>Tipo</label>
                        <input type="text" name="tipo" class="form-control" value="{{ emp.tipo }}">
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <input type="text" name="status" class="form-control" value="{{ emp.status }}">
                    </div>
                    <div class="form-group">
                        <label>Localiza√ß√£o</label>
                        <input type="text" name="localizacao" class="form-control" value="{{ emp.localizacao }}">
                    </div>
                    <div class="form-group">
                        <label>Quartos</label>
                        <input type="number" name="quartos" class="form-control" value="{{ emp.quartos }}">
                    </div>
                    <div class="form-group">
                        <label>Banheiros</label>
                        <input type="number" name="banheiros" class="form-control" value="{{ emp.banheiros }}">
                    </div>
                    <div class="form-group">
                        <label>√Årea</label>
                        <input type="text" name="area" class="form-control" value="{{ emp.area }}">
                    </div>
                    <div class="form-group">
                        <label>Descri√ß√£o</label>
                        <textarea name="descricao" class="form-control" rows="2">{{ emp.descricao }}</textarea>
                    </div>
                    <div class="form-group">
                        <label>Pre√ßo</label>
                        <input type="text" name="preco" class="form-control" value="{{ emp.preco }}">
                    </div>
                    <div class="form-group">
                        <label>Imagem (URL)</label>
                        <input type="text" name="imagem" class="form-control" value="{{ emp.imagem }}">
                    </div>
                    <div class="form-group">
                        <label>Mensagem WhatsApp</label>
                        <input type="text" name="whatsapp_message" class="form-control" value="{{ emp.whatsapp_message }}">
                    </div>
                    <div class="empreendimento-actions">
                        <button type="submit" class="btn btn-primary btn-sm">Salvar</button>
                        <button type="button" class="btn btn-outline btn-sm" onclick="cancelarEdicaoEmpreendimento({{ emp.id }})">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
<script>
function mostrarNovoEmpreendimento() {
    document.getElementById('novo-empreendimento-form').style.display = 'block';
}
function cancelarNovoEmpreendimento() {
    document.getElementById('novo-empreendimento-form').style.display = 'none';
}
function editarEmpreendimento(empId) {
    const card = document.querySelector(`.empreendimento-card[data-emp-id='${empId}']`);
    card.querySelector('.empreendimento-view').style.display = 'none';
    card.querySelector('.empreendimento-edit-form').style.display = 'block';
}
function cancelarEdicaoEmpreendimento(empId) {
    const card = document.querySelector(`.empreendimento-card[data-emp-id='${empId}']`);
    card.querySelector('.empreendimento-view').style.display = 'block';
    card.querySelector('.empreendimento-edit-form').style.display = 'none';
}
async function deletarEmpreendimento(empId) {
    if (!confirm('Tem certeza que deseja deletar este empreendimento?')) return;
    try {
        const response = await fetch(`/admin/empreendimentos/${empId}/deletar`, { method: 'DELETE' });
        const data = await response.json();
        if (response.ok) {
            alert(data.mensagem);
            location.reload();
        } else {
            alert('Erro: ' + data.mensagem);
        }
    } catch (error) {
        alert('Erro ao deletar empreendimento');
    }
}
</script>
{% endblock %}