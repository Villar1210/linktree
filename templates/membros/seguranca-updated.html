{% extends "base.html" %}

{% block title %}Segurança - Lumiar{% endblock %}

{% block extra_css %}
<style>
    .seguranca-container {
        padding: 2rem 0;
        background: #f8fafc;
        min-height: calc(100vh - 80px);
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 1rem;
    }

    /* Page Header */
    .page-header {
        text-align: center;
        margin-bottom: 3rem;
        padding: 2rem;
        background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
        color: white;
        border-radius: 1rem;
        box-shadow: 0 10px 25px -5px rgba(220, 38, 38, 0.3);
        position: relative;
        overflow: hidden;
    }

    .page-header::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: repeating-linear-gradient(
            45deg,
            transparent,
            transparent 10px,
            rgba(255, 255, 255, 0.05) 10px,
            rgba(255, 255, 255, 0.05) 20px
        );
        animation: security-pattern 20s linear infinite;
    }

    @keyframes security-pattern {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .page-header h1 {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.75rem;
        position: relative;
        z-index: 1;
    }

    .page-header p {
        font-size: 1.1rem;
        opacity: 0.9;
        margin: 0;
        position: relative;
        z-index: 1;
    }

    /* Section Layout */
    .seguranca-layout {
        display: grid;
        gap: 2rem;
    }

    .seguranca-section {
        background: white;
        padding: 2rem;
        border-radius: 1rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        border: 1px solid #e5e7eb;
    }

    .section-header {
        margin-bottom: 2rem;
    }

    .section-header h2 {
        font-size: 1.5rem;
        font-weight: 700;
        color: #1f2937;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 0.5rem;
    }

    .section-header h2 i {
        color: #dc2626;
    }

    .section-header p {
        color: #6b7280;
        margin: 0;
    }

    /* Security Cards */
    .security-card {
        background: #f9fafb;
        border: 2px solid #e5e7eb;
        border-radius: 0.75rem;
        margin-bottom: 1.5rem;
        transition: all 0.3s ease;
        overflow: hidden;
    }

    .security-card:last-child {
        margin-bottom: 0;
    }

    .security-card:hover {
        border-color: #dc2626;
        box-shadow: 0 8px 15px rgba(220, 38, 38, 0.1);
        transform: translateY(-1px);
    }

    .security-card-header {
        padding: 1.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid #e5e7eb;
        background: white;
    }

    .security-info h3 {
        font-size: 1.1rem;
        font-weight: 700;
        color: #1f2937;
        margin-bottom: 0.25rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .security-info h3 i {
        color: #dc2626;
        font-size: 1rem;
    }

    .security-info p {
        color: #6b7280;
        font-size: 0.9rem;
        margin: 0;
    }

    .security-card-body {
        padding: 1.5rem;
    }

    .info-text {
        color: #4b5563;
        margin-bottom: 1rem;
        font-size: 0.95rem;
        line-height: 1.5;
    }

    /* Status Badges */
    .badge {
        padding: 0.375rem 0.75rem;
        border-radius: 0.5rem;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        display: flex;
        align-items: center;
        gap: 0.25rem;
    }

    .badge-success {
        background: #d1fae5;
        color: #065f46;
    }

    .badge-warning {
        background: #fef3c7;
        color: #92400e;
    }

    .badge-danger {
        background: #fee2e2;
        color: #991b1b;
    }

    .badge-info {
        background: #dbeafe;
        color: #1e40af;
    }

    /* Security Status Indicators */
    .security-status {
        display: flex;
        align-items: center;
    }

    /* Buttons */
    .btn {
        padding: 0.5rem 1rem;
        border: none;
        border-radius: 0.5rem;
        font-weight: 600;
        font-size: 0.875rem;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        border: 2px solid transparent;
    }

    .btn-primary {
        background: linear-gradient(135deg, #dc2626, #ef4444);
        color: white;
    }

    .btn-primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(220, 38, 38, 0.4);
    }

    .btn-danger {
        background: #991b1b;
        color: white;
    }

    .btn-danger:hover {
        background: #7f1d1d;
        transform: translateY(-1px);
    }

    .btn-outline {
        background: transparent;
        color: #374151;
        border-color: #d1d5db;
    }

    .btn-outline:hover {
        background: #f9fafb;
        border-color: #9ca3af;
    }

    .btn-sm {
        padding: 0.375rem 0.75rem;
        font-size: 0.75rem;
    }

    .form-actions {
        display: flex;
        gap: 0.75rem;
        flex-wrap: wrap;
    }

    /* Access Table */
    .acessos-table {
        overflow-x: auto;
        border-radius: 0.5rem;
        border: 1px solid #e5e7eb;
    }

    .acessos-table table {
        width: 100%;
        border-collapse: collapse;
        background: white;
    }

    .acessos-table th {
        background: #f9fafb;
        padding: 1rem;
        text-align: left;
        font-weight: 600;
        color: #374151;
        border-bottom: 1px solid #e5e7eb;
        font-size: 0.875rem;
    }

    .acessos-table td {
        padding: 0.75rem 1rem;
        border-bottom: 1px solid #f3f4f6;
        font-size: 0.875rem;
    }

    .acesso-row:hover {
        background: #f9fafb;
    }

    .acesso-login {
        border-left: 4px solid #059669;
    }

    .acesso-logout {
        border-left: 4px solid #dc2626;
    }

    .tipo-acesso {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-weight: 600;
    }

    .tipo-acesso i {
        width: 16px;
    }

    .acesso-row code {
        background: #f3f4f6;
        padding: 0.25rem 0.5rem;
        border-radius: 0.25rem;
        font-family: 'Courier New', monospace;
        font-size: 0.8rem;
    }

    /* Tips Grid */
    .tips-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.5rem;
    }

    .tip-card {
        background: white;
        padding: 2rem 1.5rem;
        border-radius: 0.75rem;
        text-align: center;
        border: 2px solid #e5e7eb;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .tip-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #dc2626, #ef4444, #f87171);
    }

    .tip-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 25px rgba(220, 38, 38, 0.15);
        border-color: #dc2626;
    }

    .tip-icon {
        width: 60px;
        height: 60px;
        background: linear-gradient(135deg, #fee2e2, #fecaca);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1rem;
        transition: all 0.3s ease;
    }

    .tip-card:hover .tip-icon {
        background: linear-gradient(135deg, #dc2626, #ef4444);
        transform: scale(1.1);
    }

    .tip-icon i {
        font-size: 1.5rem;
        color: #dc2626;
        transition: color 0.3s ease;
    }

    .tip-card:hover .tip-icon i {
        color: white;
    }

    .tip-card h3 {
        font-size: 1.1rem;
        font-weight: 700;
        color: #1f2937;
        margin-bottom: 0.75rem;
    }

    .tip-card p {
        color: #6b7280;
        font-size: 0.9rem;
        line-height: 1.5;
        margin: 0;
    }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 4rem 2rem;
        color: #6b7280;
        background: white;
        border-radius: 0.5rem;
        border: 1px solid #e5e7eb;
    }

    .empty-state i {
        font-size: 4rem;
        color: #d1d5db;
        margin-bottom: 1rem;
    }

    .empty-state p {
        font-size: 1.1rem;
        margin: 0;
    }

    /* Security Level Indicator */
    .security-level {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem;
        background: linear-gradient(135deg, #f0fdf4, #dcfce7);
        border: 2px solid #22c55e;
        border-radius: 0.5rem;
        margin-bottom: 2rem;
    }

    .security-level-icon {
        width: 48px;
        height: 48px;
        background: linear-gradient(135deg, #16a34a, #22c55e);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.25rem;
    }

    .security-level-info h3 {
        font-weight: 700;
        color: #15803d;
        margin-bottom: 0.25rem;
    }

    .security-level-info p {
        color: #166534;
        margin: 0;
        font-size: 0.9rem;
    }

    /* Loading States */
    .loading {
        opacity: 0.6;
        pointer-events: none;
        position: relative;
    }

    .loading::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 20px;
        height: 20px;
        margin: -10px 0 0 -10px;
        border: 2px solid #dc2626;
        border-top-color: transparent;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {
        .seguranca-container {
            padding: 1rem 0;
            min-height: calc(100vh - 160px);
        }

        .container {
            padding: 0 0.5rem;
        }

        .page-header {
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .page-header h1 {
            font-size: 1.75rem;
            flex-direction: column;
            gap: 0.5rem;
        }

        .seguranca-section {
            padding: 1.5rem;
        }

        .security-card-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 1rem;
        }

        .tips-grid {
            grid-template-columns: 1fr;
        }

        .acessos-table {
            font-size: 0.8rem;
        }

        .acessos-table th,
        .acessos-table td {
            padding: 0.5rem;
        }

        .form-actions {
            flex-direction: column;
        }

        .form-actions .btn {
            justify-content: center;
        }

        .security-level {
            flex-direction: column;
            text-align: center;
        }
    }

    @media (max-width: 480px) {
        .tip-card {
            padding: 1.5rem 1rem;
        }

        .acessos-table th:nth-child(3),
        .acessos-table td:nth-child(3) {
            display: none; /* Hide browser column on very small screens */
        }
    }

    /* Alert Styles */
    .alert {
        padding: 1rem;
        border-radius: 0.5rem;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .alert-success {
        background: #d1fae5;
        color: #065f46;
        border: 1px solid #a7f3d0;
    }

    .alert-error {
        background: #fee2e2;
        color: #991b1b;
        border: 1px solid #fca5a5;
    }

    .alert-warning {
        background: #fef3c7;
        color: #92400e;
        border: 1px solid #fde68a;
    }

    /* 2FA Modal Styles */
    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(4px);
    }

    .modal-content {
        background: white;
        margin: 10% auto;
        padding: 2rem;
        border-radius: 1rem;
        width: 90%;
        max-width: 500px;
        position: relative;
        animation: modalSlideIn 0.3s ease;
    }

    @keyframes modalSlideIn {
        from { transform: translateY(-50px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }

    .modal-header {
        margin-bottom: 1.5rem;
    }

    .modal-header h3 {
        font-size: 1.5rem;
        font-weight: 700;
        color: #1f2937;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .modal-close {
        position: absolute;
        top: 1rem;
        right: 1rem;
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: #6b7280;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: all 0.3s ease;
    }

    .modal-close:hover {
        background: #f3f4f6;
        color: #374151;
    }
</style>
{% endblock %}

{% block content %}
<div class="seguranca-container">
    <div class="container">
        <div class="page-header">
            <h1>
                <i class="fas fa-shield-alt"></i>
                <span>Segurança da Conta</span>
            </h1>
            <p>Gerencie as configurações de segurança e proteja sua conta</p>
        </div>

        <!-- Security Level Indicator -->
        {% set security_score = 0 %}
        {% if config_seg and config_seg.autenticacao_2fa %}
            {% set security_score = security_score + 40 %}
        {% endif %}
        {% set security_score = security_score + 30 %} <!-- Base security -->
        {% if current_user.ultimo_acesso %}
            {% set security_score = security_score + 20 %}
        {% endif %}
        {% set security_score = security_score + 10 %} <!-- Active monitoring -->

        <div class="security-level">
            <div class="security-level-icon">
                {% if security_score >= 80 %}
                    <i class="fas fa-shield-alt"></i>
                {% elif security_score >= 60 %}
                    <i class="fas fa-exclamation-triangle" style="color: #f59e0b;"></i>
                {% else %}
                    <i class="fas fa-times" style="color: #ef4444;"></i>
                {% endif %}
            </div>
            <div class="security-level-info">
                <h3>Nível de Segurança: {{ security_score }}%</h3>
                <p>
                    {% if security_score >= 80 %}
                        Excelente! Sua conta está muito bem protegida.
                    {% elif security_score >= 60 %}
                        Boa proteção, mas pode ser melhorada ativando mais recursos.
                    {% else %}
                        Atenção! Ative mais recursos de segurança para proteger sua conta.
                    {% endif %}
                </p>
            </div>
        </div>

        <div class="seguranca-layout">
            <!-- Segurança Principal -->
            <section class="seguranca-section">
                <div class="section-header">
                    <h2><i class="fas fa-lock"></i> Configurações de Proteção</h2>
                    <p>Configure os recursos de segurança da sua conta</p>
                </div>

                <!-- Autenticação 2FA -->
                <div class="security-card">
                    <div class="security-card-header">
                        <div class="security-info">
                            <h3><i class="fas fa-mobile-alt"></i> Autenticação de Dois Fatores (2FA)</h3>
                            <p>Adicione uma camada extra de proteção com código SMS</p>
                        </div>
                        <div class="security-status">
                            {% if config_seg and config_seg.autenticacao_2fa %}
                                <span class="badge badge-success">
                                    <i class="fas fa-check-circle"></i> Ativado
                                </span>
                            {% else %}
                                <span class="badge badge-warning">
                                    <i class="fas fa-exclamation-circle"></i> Desativado
                                </span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="security-card-body">
                        {% if config_seg and config_seg.autenticacao_2fa %}
                            <p class="info-text">
                                <i class="fas fa-check-circle" style="color: #059669; margin-right: 0.5rem;"></i>
                                Seu 2FA está ativo! Você receberá um código por SMS a cada login para maior segurança.
                            </p>
                            <div class="form-actions">
                                <button class="btn btn-danger btn-sm" id="disable2fa">
                                    <i class="fas fa-times"></i> Desativar 2FA
                                </button>
                                <button class="btn btn-outline btn-sm" id="test2fa">
                                    <i class="fas fa-vial"></i> Testar 2FA
                                </button>
                            </div>
                        {% else %}
                            <p class="info-text">
                                <i class="fas fa-exclamation-triangle" style="color: #f59e0b; margin-right: 0.5rem;"></i>
                                Ative 2FA para aumentar significativamente a segurança da sua conta. Um código será enviado por SMS a cada login.
                            </p>
                            <div class="form-actions">
                                <button class="btn btn-primary btn-sm" id="enable2fa">
                                    <i class="fas fa-shield-alt"></i> Ativar 2FA
                                </button>
                            </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Alterar Senha -->
                <div class="security-card">
                    <div class="security-card-header">
                        <div class="security-info">
                            <h3><i class="fas fa-key"></i> Senha da Conta</h3>
                            <p>Mantenha sua senha atualizada e segura</p>
                        </div>
                        <div class="security-status">
                            {% set days_since_change = (moment().subtract(30, 'days')) if moment else 30 %}
                            {% if days_since_change < 90 %}
                                <span class="badge badge-success">
                                    <i class="fas fa-check"></i> Atualizada
                                </span>
                            {% else %}
                                <span class="badge badge-warning">
                                    <i class="fas fa-clock"></i> Antiga
                                </span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="security-card-body">
                        <p class="info-text">
                            <i class="fas fa-history" style="color: #6b7280; margin-right: 0.5rem;"></i>
                            Última alteração: <strong>{{ current_user.data_atualizacao.strftime('%d/%m/%Y') if current_user.data_atualizacao else '30 dias atrás' }}</strong>
                        </p>
                        <div class="form-actions">
                            <a href="/membros/alterar-senha" class="btn btn-primary btn-sm">
                                <i class="fas fa-edit"></i> Alterar Senha
                            </a>
                            <button class="btn btn-outline btn-sm" id="generatePassword">
                                <i class="fas fa-random"></i> Gerar Senha Forte
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Sessões Ativas -->
                <div class="security-card">
                    <div class="security-card-header">
                        <div class="security-info">
                            <h3><i class="fas fa-laptop"></i> Sessões e Dispositivos</h3>
                            <p>Monitore e gerencie suas sessões ativas</p>
                        </div>
                        <div class="security-status">
                            <span class="badge badge-info">
                                <i class="fas fa-desktop"></i> 1 Ativa
                            </span>
                        </div>
                    </div>

                    <div class="security-card-body">
                        <p class="info-text">
                            <i class="fas fa-desktop" style="color: #2563eb; margin-right: 0.5rem;"></i>
                            Você tem <strong>1 sessão ativa</strong> neste dispositivo. Última atividade: <strong>agora</strong>
                        </p>
                        <div class="form-actions">
                            <button class="btn btn-outline btn-sm" id="logoutAll">
                                <i class="fas fa-sign-out-alt"></i> Encerrar Todas as Sessões
                            </button>
                            <button class="btn btn-outline btn-sm" id="viewSessions">
                                <i class="fas fa-list"></i> Ver Detalhes
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Backup e Recuperação -->
                <div class="security-card">
                    <div class="security-card-header">
                        <div class="security-info">
                            <h3><i class="fas fa-download"></i> Backup e Recuperação</h3>
                            <p>Proteja seus dados com backup automático</p>
                        </div>
                        <div class="security-status">
                            <span class="badge badge-success">
                                <i class="fas fa-cloud"></i> Ativo
                            </span>
                        </div>
                    </div>

                    <div class="security-card-body">
                        <p class="info-text">
                            <i class="fas fa-cloud-upload-alt" style="color: #059669; margin-right: 0.5rem;"></i>
                            Backup automático ativo. Seus dados são protegidos e podem ser recuperados a qualquer momento.
                        </p>
                        <div class="form-actions">
                            <button class="btn btn-outline btn-sm" id="downloadBackup">
                                <i class="fas fa-download"></i> Baixar Backup
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Acessos Recentes -->
            <section class="seguranca-section">
                <div class="section-header">
                    <h2><i class="fas fa-history"></i> Histórico de Acessos</h2>
                    <p>Monitore todas as atividades da sua conta (últimos 20 acessos)</p>
                </div>

                {% if acessos_recentes %}
                    <div class="acessos-table">
                        <table>
                            <thead>
                                <tr>
                                    <th><i class="fas fa-tag"></i> Tipo</th>
                                    <th><i class="fas fa-map-marker-alt"></i> IP</th>
                                    <th><i class="fas fa-browser"></i> Navegador</th>
                                    <th><i class="fas fa-clock"></i> Data/Hora</th>
                                    <th><i class="fas fa-info-circle"></i> Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for acesso in acessos_recentes %}
                                    <tr class="acesso-row acesso-{{ acesso.tipo_acesso }}">
                                        <td>
                                            <div class="tipo-acesso">
                                                {% if acesso.tipo_acesso == 'login' %}
                                                    <i class="fas fa-sign-in-alt" style="color: #059669;"></i> Login
                                                {% elif acesso.tipo_acesso == 'logout' %}
                                                    <i class="fas fa-sign-out-alt" style="color: #dc2626;"></i> Logout
                                                {% elif 'admin' in acesso.tipo_acesso.lower() %}
                                                    <i class="fas fa-cog" style="color: #f59e0b;"></i> Admin
                                                {% elif 'seguranca' in acesso.tipo_acesso.lower() %}
                                                    <i class="fas fa-shield-alt" style="color: #dc2626;"></i> Segurança
                                                {% else %}
                                                    <i class="fas fa-mouse-pointer" style="color: #2563eb;"></i> Navegação
                                                {% endif %}
                                            </div>
                                        </td>
                                        <td>
                                            <code>{{ acesso.endereco_ip or '127.0.0.1' }}</code>
                                            {% if acesso.endereco_ip and acesso.endereco_ip.startswith('127.') %}
                                                <small style="color: #059669;">(Local)</small>
                                            {% endif %}
                                        </td>
                                        <td>
                                            <small>{{ (acesso.navegador[:40] + '...') if (acesso.navegador and acesso.navegador|length > 40) else (acesso.navegador or 'Não identificado') }}</small>
                                        </td>
                                        <td>
                                            <small>{{ acesso.data_hora.strftime('%d/%m/%Y') }}<br>{{ acesso.data_hora.strftime('%H:%M:%S') }}</small>
                                        </td>
                                        <td>
                                            {% if acesso.tipo_acesso == 'login' %}
                                                <span class="badge badge-success">Sucesso</span>
                                            {% elif acesso.tipo_acesso == 'logout' %}
                                                <span class="badge badge-info">Normal</span>
                                            {% elif 'admin' in acesso.tipo_acesso.lower() %}
                                                <span class="badge badge-warning">Admin</span>
                                            {% elif 'erro' in acesso.tipo_acesso.lower() %}
                                                <span class="badge badge-danger">Erro</span>
                                            {% else %}
                                                <span class="badge badge-info">{{ acesso.tipo_acesso|title }}</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    <div style="margin-top: 1rem; text-align: center;">
                        <button class="btn btn-outline btn-sm" id="exportHistory">
                            <i class="fas fa-file-export"></i> Exportar Histórico Completo
                        </button>
                    </div>
                {% else %}
                    <div class="empty-state">
                        <i class="fas fa-history"></i>
                        <p>Nenhum acesso registrado ainda</p>
                        <small>O histórico aparecerá conforme você usar o sistema</small>
                    </div>
                {% endif %}
            </section>

            <!-- Dicas de Segurança -->
            <section class="seguranca-section">
                <div class="section-header">
                    <h2><i class="fas fa-lightbulb"></i> Dicas de Segurança</h2>
                    <p>Siga essas boas práticas para manter sua conta protegida</p>
                </div>

                <div class="tips-grid">
                    <div class="tip-card">
                        <div class="tip-icon">
                            <i class="fas fa-key"></i>
                        </div>
                        <h3>Senhas Fortes</h3>
                        <p>Use senhas com pelo menos 12 caracteres, incluindo letras maiúsculas, minúsculas, números e símbolos especiais.</p>
                    </div>

                    <div class="tip-card">
                        <div class="tip-icon">
                            <i class="fas fa-mobile-alt"></i>
                        </div>
                        <h3>Autenticação 2FA</h3>
                        <p>Ative a autenticação de dois fatores para adicionar uma camada extra de segurança ao seu login.</p>
                    </div>

                    <div class="tip-card">
                        <div class="tip-icon">
                            <i class="fas fa-wifi"></i>
                        </div>
                        <h3>Redes Seguras</h3>
                        <p>Evite acessar sua conta em redes Wi-Fi públicas. Use sempre conexões seguras e confiáveis.</p>
                    </div>

                    <div class="tip-card">
                        <div class="tip-icon">
                            <i class="fas fa-history"></i>
                        </div>
                        <h3>Monitoramento</h3>
                        <p>Monitore regularmente seu histórico de acessos e reporte qualquer atividade suspeita imediatamente.</p>
                    </div>

                    <div class="tip-card">
                        <div class="tip-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <h3>Atualizações</h3>
                        <p>Mantenha seu navegador e sistema operacional sempre atualizados com as correções de segurança mais recentes.</p>
                    </div>

                    <div class="tip-card">
                        <div class="tip-icon">
                            <i class="fas fa-eye-slash"></i>
                        </div>
                        <h3>Privacidade</h3>
                        <p>Nunca compartilhe suas credenciais e sempre faça logout ao usar computadores compartilhados.</p>
                    </div>
                </div>
            </section>
        </div>
    </div>
</div>

<!-- 2FA Activation Modal -->
<div id="modal2fa" class="modal">
    <div class="modal-content">
        <button class="modal-close" onclick="close2FAModal()">&times;</button>
        <div class="modal-header">
            <h3><i class="fas fa-mobile-alt"></i> Ativar Autenticação 2FA</h3>
        </div>
        <div class="modal-body">
            <p>Para ativar a autenticação de dois fatores, precisaremos do seu número de celular:</p>
            <div style="margin: 1rem 0;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Número do Celular:</label>
                <input type="tel" id="phone2fa" class="form-control" placeholder="(11) 99999-9999" style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 0.5rem;">
            </div>
            <div class="form-actions">
                <button class="btn btn-primary btn-sm" onclick="activate2FA()">
                    <i class="fas fa-shield-alt"></i> Ativar 2FA
                </button>
                <button class="btn btn-outline btn-sm" onclick="close2FAModal()">
                    <i class="fas fa-times"></i> Cancelar
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Utility functions
function showAlert(message, type = 'success') {
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert alert-${type}`;
    alertDiv.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : 'times-circle'}"></i>
        ${message}
    `;
    
    const container = document.querySelector('.container');
    container.insertBefore(alertDiv, container.firstChild);
    
    setTimeout(() => {
        alertDiv.remove();
    }, 5000);
}

function setLoading(element, loading = true) {
    if (loading) {
        element.classList.add('loading');
        element.disabled = true;
    } else {
        element.classList.remove('loading');
        element.disabled = false;
    }
}

// 2FA Modal functions
function open2FAModal() {
    document.getElementById('modal2fa').style.display = 'block';
    document.getElementById('phone2fa').focus();
}

function close2FAModal() {
    document.getElementById('modal2fa').style.display = 'none';
    document.getElementById('phone2fa').value = '';
}

// Phone number formatting
document.getElementById('phone2fa')?.addEventListener('input', function(e) {
    let value = e.target.value.replace(/\D/g, '');
    if (value.length > 11) value = value.slice(0, 11);
    
    if (value.length >= 11) {
        value = value.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
    } else if (value.length >= 7) {
        value = value.replace(/(\d{2})(\d{4})(\d+)/, '($1) $2-$3');
    } else if (value.length >= 3) {
        value = value.replace(/(\d{2})(\d+)/, '($1) $2');
    }
    
    e.target.value = value;
});

// Activate 2FA
async function activate2FA() {
    const phone = document.getElementById('phone2fa').value;
    const btn = document.querySelector('#modal2fa .btn-primary');
    
    if (!phone || phone.length < 14) {
        showAlert('Por favor, insira um número de telefone válido', 'warning');
        return;
    }
    
    setLoading(btn, true);
    
    try {
        const response = await fetch('/membros/seguranca/2fa/ativar', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ telefone: phone })
        });
        
        const data = await response.json();
        
        if (response.ok) {
            showAlert('2FA ativado com sucesso! Você receberá um SMS de teste.', 'success');
            close2FAModal();
            setTimeout(() => location.reload(), 2000);
        } else {
            showAlert(`Erro: ${data.mensagem || 'Erro desconhecido'}`, 'error');
        }
    } catch (error) {
        console.error('Erro:', error);
        showAlert('Erro de conexão. Tente novamente.', 'error');
    } finally {
        setLoading(btn, false);
    }
}

// Event listeners
document.getElementById('enable2fa')?.addEventListener('click', open2FAModal);

document.getElementById('disable2fa')?.addEventListener('click', async function() {
    if (!confirm('Tem certeza que deseja desativar a autenticação 2FA?\n\nIsso reduzirá a segurança da sua conta.')) return;
    
    setLoading(this, true);
    
    try {
        const response = await fetch('/membros/seguranca/2fa/desativar', {
            method: 'POST'
        });
        
        const data = await response.json();
        
        if (response.ok) {
            showAlert('2FA desativado com sucesso', 'warning');
            setTimeout(() => location.reload(), 1500);
        } else {
            showAlert(`Erro: ${data.mensagem || 'Erro desconhecido'}`, 'error');
        }
    } catch (error) {
        console.error('Erro:', error);
        showAlert('Erro de conexão. Tente novamente.', 'error');
    } finally {
        setLoading(this, false);
    }
});

document.getElementById('test2fa')?.addEventListener('click', async function() {
    setLoading(this, true);
    
    try {
        const response = await fetch('/membros/seguranca/2fa/testar', {
            method: 'POST'
        });
        
        const data = await response.json();
        
        if (response.ok) {
            showAlert('Código de teste enviado! Verifique seu celular.', 'success');
        } else {
            showAlert(`Erro: ${data.mensagem || 'Erro desconhecido'}`, 'error');
        }
    } catch (error) {
        console.error('Erro:', error);
        showAlert('Erro de conexão. Tente novamente.', 'error');
    } finally {
        setLoading(this, false);
    }
});

document.getElementById('generatePassword')?.addEventListener('click', function() {
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*';
    let password = '';
    for (let i = 0; i < 16; i++) {
        password += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    
    if (navigator.clipboard) {
        navigator.clipboard.writeText(password).then(() => {
            showAlert(`Senha forte gerada e copiada: ${password}`, 'success');
        });
    } else {
        showAlert(`Senha forte gerada: ${password}`, 'success');
    }
});

document.getElementById('logoutAll')?.addEventListener('click', function() {
    if (!confirm('Tem certeza que deseja encerrar todas as sessões?\n\nVocê precisará fazer login novamente.')) return;
    
    setLoading(this, true);
    
    // Simulate logout all sessions
    setTimeout(() => {
        showAlert('Todas as sessões foram encerradas com sucesso', 'success');
        setLoading(this, false);
    }, 1000);
});

document.getElementById('downloadBackup')?.addEventListener('click', function() {
    setLoading(this, true);
    
    // Simulate backup download
    setTimeout(() => {
        showAlert('Backup iniciado! O arquivo será baixado em breve.', 'success');
        setLoading(this, false);
    }, 1500);
});

document.getElementById('exportHistory')?.addEventListener('click', function() {
    setLoading(this, true);
    
    // Simulate export
    setTimeout(() => {
        showAlert('Histórico exportado com sucesso!', 'success');
        setLoading(this, false);
    }, 1000);
});

// Close modal when clicking outside
document.getElementById('modal2fa')?.addEventListener('click', function(e) {
    if (e.target === this) {
        close2FAModal();
    }
});

// Keyboard shortcuts
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        close2FAModal();
    }
});

// Auto-update security score (demo)
setInterval(() => {
    const scoreElement = document.querySelector('.security-level-info h3');
    if (scoreElement) {
        // Could implement real-time security scoring here
    }
}, 30000); // Check every 30 seconds
</script>
{% endblock %}