{% extends "base.html" %}

{% block title %}Redes Sociais - Lumiar{% endblock %}

{% block extra_css %}
<style>
    .redes-sociais-container {
        padding: 2rem 0;
        background: #f8fafc;
        min-height: calc(100vh - 80px);
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 1rem;
    }

    /* Page Header */
    .page-header {
        text-align: center;
        margin-bottom: 3rem;
        padding: 2rem;
        background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
        color: white;
        border-radius: 1rem;
        box-shadow: 0 10px 25px -5px rgba(30, 64, 175, 0.3);
    }

    .page-header h1 {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.75rem;
    }

    .page-header p {
        font-size: 1.1rem;
        opacity: 0.9;
        margin: 0;
    }

    /* Section Headers */
    .section-header {
        margin-bottom: 2rem;
    }

    .section-header h2 {
        font-size: 1.5rem;
        font-weight: 700;
        color: #1f2937;
        margin-bottom: 0.5rem;
    }

    .section-header p {
        color: #6b7280;
        margin: 0;
    }

    /* Redes Layout */
    .redes-layout {
        display: grid;
        gap: 3rem;
    }

    .redes-section {
        background: white;
        padding: 2rem;
        border-radius: 1rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        border: 1px solid #e5e7eb;
    }

    /* Redes Grid */
    .redes-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 1.5rem;
    }

    /* Rede Card */
    .rede-card {
        background: #f8fafc;
        border: 2px solid #e5e7eb;
        border-radius: 1rem;
        padding: 1.5rem;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .rede-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        border-color: #3b82f6;
    }

    .rede-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #1e40af, #3b82f6, #06b6d4);
    }

    /* Rede Header */
    .rede-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }

    .rede-info {
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .rede-info i {
        font-size: 1.5rem;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 0.5rem;
        background: linear-gradient(135deg, #1e40af, #3b82f6);
        color: white;
    }

    .rede-info h3 {
        font-size: 1.2rem;
        font-weight: 700;
        color: #1f2937;
        margin: 0;
    }

    /* Status Badges */
    .badge {
        padding: 0.25rem 0.75rem;
        border-radius: 0.5rem;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        display: flex;
        align-items: center;
        gap: 0.25rem;
    }

    .badge-success {
        background: #d1fae5;
        color: #065f46;
    }

    .badge-danger {
        background: #fee2e2;
        color: #991b1b;
    }

    /* Rede Details */
    .rede-details {
        margin-bottom: 1rem;
    }

    .detail-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.5rem 0;
        border-bottom: 1px solid #f3f4f6;
    }

    .detail-row:last-child {
        border-bottom: none;
    }

    .detail-row .label {
        font-weight: 600;
        color: #374151;
        font-size: 0.9rem;
    }

    .detail-row .value {
        color: #6b7280;
        font-size: 0.9rem;
        max-width: 60%;
        text-align: right;
        word-break: break-all;
    }

    .detail-row .value.link {
        color: #2563eb;
        text-decoration: none;
    }

    .detail-row .value.link:hover {
        text-decoration: underline;
    }

    /* Rede Actions */
    .rede-actions {
        display: flex;
        gap: 0.5rem;
        justify-content: flex-end;
    }

    /* Edit Form */
    .rede-edit-form {
        padding: 1rem;
        background: white;
        border-radius: 0.5rem;
        border: 1px solid #e5e7eb;
        margin-top: 1rem;
    }

    .form-control {
        width: 100%;
        padding: 0.75rem;
        border: 2px solid #e5e7eb;
        border-radius: 0.5rem;
        font-size: 0.9rem;
        transition: border-color 0.3s ease;
    }

    .form-control:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .mb-2 {
        margin-bottom: 0.5rem;
    }

    .form-actions {
        display: flex;
        gap: 0.5rem;
        justify-content: flex-end;
        margin-top: 1rem;
    }

    /* Buttons */
    .btn {
        padding: 0.5rem 1rem;
        border: none;
        border-radius: 0.5rem;
        font-weight: 600;
        font-size: 0.875rem;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        border: 2px solid transparent;
    }

    .btn-primary {
        background: linear-gradient(135deg, #1e40af, #3b82f6);
        color: white;
    }

    .btn-primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
    }

    .btn-outline {
        background: transparent;
        color: #374151;
        border-color: #d1d5db;
    }

    .btn-outline:hover {
        background: #f9fafb;
        border-color: #9ca3af;
    }

    .btn-danger {
        background: #dc2626;
        color: white;
    }

    .btn-danger:hover {
        background: #b91c1c;
        transform: translateY(-1px);
    }

    .btn-sm {
        padding: 0.375rem 0.75rem;
        font-size: 0.75rem;
    }

    /* Redes Disponíveis */
    .redes-disponiveis-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
    }

    .rede-add-card {
        background: white;
        padding: 2rem 1.5rem;
        border-radius: 1rem;
        text-align: center;
        border: 2px dashed #d1d5db;
        transition: all 0.3s ease;
        position: relative;
    }

    .rede-add-card:hover {
        border-color: #3b82f6;
        transform: translateY(-2px);
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
    }

    .rede-add-icon {
        width: 60px;
        height: 60px;
        background: linear-gradient(135deg, #e5e7eb, #f3f4f6);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1rem;
        transition: all 0.3s ease;
    }

    .rede-add-card:hover .rede-add-icon {
        background: linear-gradient(135deg, #1e40af, #3b82f6);
        color: white;
        transform: scale(1.1);
    }

    .rede-add-icon i {
        font-size: 1.5rem;
        color: #6b7280;
        transition: color 0.3s ease;
    }

    .rede-add-card:hover .rede-add-icon i {
        color: white;
    }

    .rede-add-card h3 {
        font-size: 1.1rem;
        font-weight: 700;
        color: #1f2937;
        margin-bottom: 1rem;
    }

    /* Add Form */
    .rede-add-form {
        text-align: left;
        padding: 1.5rem;
        background: #f8fafc;
        border-radius: 0.5rem;
        margin-top: 1rem;
        border: 1px solid #e5e7eb;
    }

    .form-group {
        margin-bottom: 1rem;
    }

    .form-group label {
        display: block;
        font-weight: 600;
        color: #374151;
        margin-bottom: 0.25rem;
        font-size: 0.875rem;
    }

    .form-group small {
        display: block;
        color: #6b7280;
        font-size: 0.75rem;
        margin-top: 0.25rem;
    }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 4rem 2rem;
        color: #6b7280;
    }

    .empty-state i {
        font-size: 4rem;
        color: #d1d5db;
        margin-bottom: 1rem;
    }

    .empty-state p {
        font-size: 1.1rem;
        margin: 0;
    }

    /* Social Network Colors */
    .rede-info i.fa-facebook { background: linear-gradient(135deg, #1877f2, #42a5f5) !important; }
    .rede-info i.fa-instagram { background: linear-gradient(135deg, #e4405f, #f77737) !important; }
    .rede-info i.fa-twitter { background: linear-gradient(135deg, #1da1f2, #0d8bd9) !important; }
    .rede-info i.fa-linkedin { background: linear-gradient(135deg, #0077b5, #005885) !important; }
    .rede-info i.fa-youtube { background: linear-gradient(135deg, #ff0000, #c4302b) !important; }
    .rede-info i.fa-tiktok { background: linear-gradient(135deg, #000000, #25f4ee) !important; }
    .rede-info i.fa-whatsapp { background: linear-gradient(135deg, #25d366, #128c7e) !important; }

    .rede-add-icon .fa-facebook { color: #1877f2 !important; }
    .rede-add-icon .fa-instagram { color: #e4405f !important; }
    .rede-add-icon .fa-twitter { color: #1da1f2 !important; }
    .rede-add-icon .fa-linkedin { color: #0077b5 !important; }
    .rede-add-icon .fa-youtube { color: #ff0000 !important; }
    .rede-add-icon .fa-tiktok { color: #000000 !important; }
    .rede-add-icon .fa-whatsapp { color: #25d366 !important; }

    /* Loading States */
    .loading {
        opacity: 0.6;
        pointer-events: none;
    }

    .loading::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 20px;
        height: 20px;
        margin: -10px 0 0 -10px;
        border: 2px solid #3b82f6;
        border-top-color: transparent;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {
        .redes-sociais-container {
            padding: 1rem 0;
            min-height: calc(100vh - 160px);
        }

        .container {
            padding: 0 0.5rem;
        }

        .page-header {
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .page-header h1 {
            font-size: 1.75rem;
            flex-direction: column;
            gap: 0.5rem;
        }

        .redes-section {
            padding: 1.5rem;
        }

        .redes-grid {
            grid-template-columns: 1fr;
        }

        .redes-disponiveis-grid {
            grid-template-columns: repeat(2, 1fr);
        }

        .rede-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 0.75rem;
        }

        .rede-actions {
            justify-content: stretch;
        }

        .rede-actions .btn {
            flex: 1;
            justify-content: center;
        }

        .detail-row {
            flex-direction: column;
            align-items: flex-start;
            gap: 0.25rem;
        }

        .detail-row .value {
            max-width: 100%;
            text-align: left;
        }
    }

    @media (max-width: 480px) {
        .redes-disponiveis-grid {
            grid-template-columns: 1fr;
        }

        .rede-add-card {
            padding: 1.5rem 1rem;
        }

        .form-actions {
            flex-direction: column;
        }

        .rede-actions {
            flex-direction: column;
        }
    }

    /* Success/Error Messages */
    .alert {
        padding: 1rem;
        border-radius: 0.5rem;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .alert-success {
        background: #d1fae5;
        color: #065f46;
        border: 1px solid #a7f3d0;
    }

    .alert-error {
        background: #fee2e2;
        color: #991b1b;
        border: 1px solid #fca5a5;
    }
</style>
{% endblock %}

{% block content %}
<div class="redes-sociais-container">
    <div class="container">
        <div class="page-header">
            <h1>
                <i class="fas fa-share-alt"></i>
                <span>Minhas Redes Sociais</span>
            </h1>
            <p>Gerencie e configure suas credenciais de redes sociais de forma segura</p>
        </div>

        <div class="redes-layout">
            <!-- Redes Adicionadas -->
            <section class="redes-section">
                <div class="section-header">
                    <h2><i class="fas fa-link" style="color: #1e40af; margin-right: 0.5rem;"></i>Redes Sociais Conectadas</h2>
                    {% if redes %}
                        <p>{{ redes|length }} rede{{ 's' if redes|length != 1 else '' }} conectada{{ 's' if redes|length != 1 else '' }}</p>
                    {% endif %}
                </div>

                {% if redes %}
                    <div class="redes-grid">
                        {% for rede in redes %}
                            <div class="rede-card" data-rede-id="{{ rede.id }}">
                                <div class="rede-header">
                                    <div class="rede-info">
                                        <i class="fab fa-{{ rede.rede.lower() }}"></i>
                                        <div>
                                            <h3>{{ rede.rede }}</h3>
                                            <small style="color: #6b7280;">@{{ rede.usuario_rede }}</small>
                                        </div>
                                    </div>
                                    <div class="rede-status">
                                        {% if rede.ativo %}
                                            <span class="badge badge-success">
                                                <i class="fas fa-check-circle"></i> Ativo
                                            </span>
                                        {% else %}
                                            <span class="badge badge-danger">
                                                <i class="fas fa-times-circle"></i> Inativo
                                            </span>
                                        {% endif %}
                                    </div>
                                </div>

                                <div class="rede-details">
                                    <div class="detail-row">
                                        <span class="label">Usuário:</span>
                                        <span class="value">{{ rede.usuario_rede }}</span>
                                    </div>
                                    {% if rede.url %}
                                        <div class="detail-row">
                                            <span class="label">Perfil:</span>
                                            <a href="{{ rede.url }}" target="_blank" class="value link">
                                                <i class="fas fa-external-link-alt" style="font-size: 0.7rem;"></i>
                                                Ver perfil
                                            </a>
                                        </div>
                                    {% endif %}
                                    <div class="detail-row">
                                        <span class="label">Adicionado:</span>
                                        <span class="value">{{ rede.data_criacao.strftime('%d/%m/%Y') if rede.data_criacao else 'N/A' }}</span>
                                    </div>
                                </div>

                                <div class="rede-actions">
                                    <button class="btn btn-sm btn-outline edit-btn" data-rede-id="{{ rede.id }}">
                                        <i class="fas fa-edit"></i> Editar
                                    </button>
                                    <button class="btn btn-sm btn-danger delete-btn" data-rede-id="{{ rede.id }}">
                                        <i class="fas fa-trash"></i> Remover
                                    </button>
                                </div>

                                <!-- Edit Form (Hidden) -->
                                <div class="rede-edit-form" style="display: none;">
                                    <div class="form-group">
                                        <label>Usuário da Rede</label>
                                        <input type="text" class="form-control" placeholder="Usuário" value="{{ rede.usuario_rede }}" data-field="usuario_rede">
                                    </div>
                                    <div class="form-group">
                                        <label>URL do Perfil</label>
                                        <input type="url" class="form-control" placeholder="https://..." value="{{ rede.url or '' }}" data-field="url">
                                    </div>
                                    <div class="form-group">
                                        <label>Token/API Key</label>
                                        <input type="password" class="form-control" placeholder="Token (opcional)" data-field="token">
                                        <small>Deixe em branco para manter o token atual</small>
                                    </div>
                                    <div class="form-actions">
                                        <button class="btn btn-primary btn-sm save-btn">
                                            <i class="fas fa-save"></i> Salvar
                                        </button>
                                        <button class="btn btn-outline btn-sm cancel-btn">
                                            <i class="fas fa-times"></i> Cancelar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="empty-state">
                        <i class="fas fa-share-alt"></i>
                        <p>Você ainda não conectou nenhuma rede social</p>
                        <small>Adicione suas redes sociais abaixo para começar</small>
                    </div>
                {% endif %}
            </section>

            <!-- Redes Disponíveis para Adicionar -->
            <section class="redes-section">
                <div class="section-header">
                    <h2><i class="fas fa-plus-circle" style="color: #059669; margin-right: 0.5rem;"></i>Adicionar Novas Redes</h2>
                    <p>Conecte suas redes sociais para melhor gestão e integração</p>
                </div>

                {% if redes_nao_adicionadas %}
                    <div class="redes-disponiveis-grid">
                        {% for rede_nome in redes_nao_adicionadas %}
                            <div class="rede-add-card">
                                <div class="rede-add-icon">
                                    <i class="fab fa-{{ rede_nome.lower() }}"></i>
                                </div>
                                <h3>{{ rede_nome }}</h3>
                                <button class="btn btn-primary btn-sm add-rede-btn" data-rede="{{ rede_nome }}">
                                    <i class="fas fa-plus"></i> Conectar
                                </button>

                                <!-- Add Form (Hidden) -->
                                <div class="rede-add-form" style="display: none;" data-rede="{{ rede_nome }}">
                                    <div class="form-group">
                                        <label><i class="fas fa-user"></i> Usuário da Rede</label>
                                        <input type="text" class="form-control" placeholder="Seu username/handle" data-field="usuario_rede">
                                    </div>
                                    <div class="form-group">
                                        <label><i class="fas fa-link"></i> URL do Perfil</label>
                                        <input type="url" class="form-control" placeholder="https://{{ rede_nome.lower() }}.com/seuusuario" data-field="url">
                                    </div>
                                    <div class="form-group">
                                        <label><i class="fas fa-key"></i> Token / API Key</label>
                                        <input type="password" class="form-control" placeholder="Token de acesso (opcional)" data-field="token">
                                        <small><i class="fas fa-lock"></i> Seus tokens são criptografados e armazenados com segurança</small>
                                    </div>
                                    <div class="form-actions">
                                        <button class="btn btn-primary btn-sm confirm-add-btn" data-rede="{{ rede_nome }}">
                                            <i class="fas fa-plus"></i> Adicionar {{ rede_nome }}
                                        </button>
                                        <button class="btn btn-outline btn-sm cancel-add-btn">
                                            <i class="fas fa-times"></i> Cancelar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="empty-state">
                        <i class="fas fa-check-circle" style="color: #059669;"></i>
                        <p>Todas as redes sociais disponíveis já foram adicionadas!</p>
                        <small>Você conectou todas as redes sociais suportadas</small>
                    </div>
                {% endif %}
            </section>

            <!-- Informações de Segurança -->
            <section class="redes-section" style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: 2px solid #f59e0b;">
                <div class="section-header">
                    <h2><i class="fas fa-shield-alt" style="color: #d97706; margin-right: 0.5rem;"></i>Segurança e Privacidade</h2>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <i class="fas fa-lock" style="color: #d97706; font-size: 1.25rem;"></i>
                        <div>
                            <strong>Criptografia</strong>
                            <p style="margin: 0; font-size: 0.9rem; color: #92400e;">Todos os tokens são criptografados</p>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <i class="fas fa-eye-slash" style="color: #d97706; font-size: 1.25rem;"></i>
                        <div>
                            <strong>Privacidade</strong>
                            <p style="margin: 0; font-size: 0.9rem; color: #92400e;">Dados não são compartilhados</p>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <i class="fas fa-history" style="color: #d97706; font-size: 1.25rem;"></i>
                        <div>
                            <strong>Backup</strong>
                            <p style="margin: 0; font-size: 0.9rem; color: #92400e;">Dados são protegidos por backup</p>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Utility functions
function showAlert(message, type = 'success') {
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert alert-${type}`;
    alertDiv.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-triangle'}"></i>
        ${message}
    `;
    
    const container = document.querySelector('.container');
    container.insertBefore(alertDiv, container.firstChild);
    
    // Remove alert after 5 seconds
    setTimeout(() => {
        alertDiv.remove();
    }, 5000);
}

function setLoading(element, loading = true) {
    if (loading) {
        element.classList.add('loading');
        element.disabled = true;
    } else {
        element.classList.remove('loading');
        element.disabled = false;
    }
}

// Botões de adicionar rede
document.querySelectorAll('.add-rede-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        const rede = this.dataset.rede;
        const form = document.querySelector(`.rede-add-form[data-rede="${rede}"]`);
        const card = this.closest('.rede-add-card');
        
        // Show form with animation
        form.style.display = 'block';
        this.style.display = 'none';
        
        // Focus on first input
        const firstInput = form.querySelector('input[data-field="usuario_rede"]');
        setTimeout(() => firstInput.focus(), 100);
    });
});

// Cancelar adição
document.querySelectorAll('.cancel-add-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        const form = this.closest('.rede-add-form');
        const rede = form.dataset.rede;
        
        // Clear form
        form.querySelectorAll('input').forEach(input => input.value = '');
        
        // Hide form
        form.style.display = 'none';
        document.querySelector(`.add-rede-btn[data-rede="${rede}"]`).style.display = 'inline-flex';
    });
});

// Confirmar adição de rede
document.querySelectorAll('.confirm-add-btn').forEach(btn => {
    btn.addEventListener('click', async function() {
        const rede = this.dataset.rede;
        const form = this.closest('.rede-add-form');
        
        const usuario_rede = form.querySelector('[data-field="usuario_rede"]').value.trim();
        const url = form.querySelector('[data-field="url"]').value.trim();
        const token = form.querySelector('[data-field="token"]').value.trim();

        // Validation
        if (!usuario_rede) {
            showAlert('Por favor, preencha o usuário da rede', 'error');
            form.querySelector('[data-field="usuario_rede"]').focus();
            return;
        }

        if (url && !url.startsWith('http')) {
            showAlert('Por favor, insira uma URL válida (deve começar com http:// ou https://)', 'error');
            form.querySelector('[data-field="url"]').focus();
            return;
        }

        setLoading(this, true);

        try {
            const response = await fetch('/membros/redes-sociais/adicionar', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    rede: rede,
                    usuario_rede: usuario_rede,
                    url: url,
                    token: token
                })
            });

            const data = await response.json();

            if (response.ok) {
                showAlert(`${rede} adicionada com sucesso!`, 'success');
                setTimeout(() => {
                    location.reload();
                }, 1500);
            } else {
                showAlert(`Erro: ${data.mensagem || 'Erro desconhecido'}`, 'error');
            }
        } catch (error) {
            console.error('Erro:', error);
            showAlert('Erro de conexão. Tente novamente.', 'error');
        } finally {
            setLoading(this, false);
        }
    });
});

// Deletar rede
document.querySelectorAll('.delete-btn').forEach(btn => {
    btn.addEventListener('click', async function() {
        const redeCard = this.closest('.rede-card');
        const redeNome = redeCard.querySelector('.rede-info h3').textContent;
        
        if (!confirm(`Tem certeza que deseja remover ${redeNome}?\n\nEsta ação não pode ser desfeita.`)) return;

        const redeId = this.dataset.redeId;
        setLoading(this, true);

        try {
            const response = await fetch(`/membros/redes-sociais/${redeId}/deletar`, {
                method: 'DELETE'
            });

            const data = await response.json();

            if (response.ok) {
                showAlert(`${redeNome} removida com sucesso!`, 'success');
                // Animate card removal
                redeCard.style.transition = 'all 0.3s ease';
                redeCard.style.transform = 'translateX(-100%)';
                redeCard.style.opacity = '0';
                
                setTimeout(() => {
                    location.reload();
                }, 300);
            } else {
                showAlert(`Erro: ${data.mensagem || 'Erro desconhecido'}`, 'error');
            }
        } catch (error) {
            console.error('Erro:', error);
            showAlert('Erro de conexão. Tente novamente.', 'error');
        } finally {
            setLoading(this, false);
        }
    });
});

// Editar rede
document.querySelectorAll('.edit-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        const card = this.closest('.rede-card');
        const editForm = card.querySelector('.rede-edit-form');
        const details = card.querySelector('.rede-details');
        const actions = card.querySelector('.rede-actions');

        editForm.style.display = 'block';
        details.style.display = 'none';
        actions.style.display = 'none';
        
        // Focus on first input
        const firstInput = editForm.querySelector('input[data-field="usuario_rede"]');
        setTimeout(() => firstInput.focus(), 100);
    });
});

// Cancelar edição
document.querySelectorAll('.cancel-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        const card = this.closest('.rede-card');
        const editForm = card.querySelector('.rede-edit-form');
        const details = card.querySelector('.rede-details');
        const actions = card.querySelector('.rede-actions');

        editForm.style.display = 'none';
        details.style.display = 'block';
        actions.style.display = 'flex';
    });
});

// Salvar edição de rede
document.querySelectorAll('.save-btn').forEach(btn => {
    btn.addEventListener('click', async function() {
        const card = this.closest('.rede-card');
        const redeId = card.dataset.redeId;
        const redeNome = card.querySelector('.rede-info h3').textContent;
        
        const usuario_rede = card.querySelector('[data-field="usuario_rede"]').value.trim();
        const url = card.querySelector('[data-field="url"]').value.trim();
        const token = card.querySelector('[data-field="token"]').value.trim();

        // Validation
        if (!usuario_rede) {
            showAlert('Por favor, preencha o usuário da rede', 'error');
            card.querySelector('[data-field="usuario_rede"]').focus();
            return;
        }

        if (url && !url.startsWith('http')) {
            showAlert('Por favor, insira uma URL válida', 'error');
            card.querySelector('[data-field="url"]').focus();
            return;
        }

        setLoading(this, true);

        try {
            const response = await fetch(`/membros/redes-sociais/${redeId}/editar`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    usuario_rede: usuario_rede,
                    url: url,
                    token: token
                })
            });

            const data = await response.json();

            if (response.ok) {
                showAlert(`${redeNome} atualizada com sucesso!`, 'success');
                setTimeout(() => {
                    location.reload();
                }, 1500);
            } else {
                showAlert(`Erro: ${data.mensagem || 'Erro desconhecido'}`, 'error');
            }
        } catch (error) {
            console.error('Erro:', error);
            showAlert('Erro de conexão. Tente novamente.', 'error');
        } finally {
            setLoading(this, false);
        }
    });
});

// Auto-populate URL based on network and username
document.querySelectorAll('input[data-field="usuario_rede"]').forEach(input => {
    input.addEventListener('input', function() {
        const form = this.closest('.rede-add-form');
        if (!form) return;
        
        const rede = form.dataset.rede.toLowerCase();
        const username = this.value.trim();
        const urlInput = form.querySelector('input[data-field="url"]');
        
        if (username && !urlInput.value) {
            let baseUrl = '';
            switch(rede) {
                case 'facebook':
                    baseUrl = 'https://facebook.com/';
                    break;
                case 'instagram':
                    baseUrl = 'https://instagram.com/';
                    break;
                case 'twitter':
                    baseUrl = 'https://twitter.com/';
                    break;
                case 'linkedin':
                    baseUrl = 'https://linkedin.com/in/';
                    break;
                case 'youtube':
                    baseUrl = 'https://youtube.com/@';
                    break;
                case 'tiktok':
                    baseUrl = 'https://tiktok.com/@';
                    break;
                case 'whatsapp':
                    baseUrl = 'https://wa.me/';
                    break;
            }
            
            if (baseUrl) {
                urlInput.value = baseUrl + username.replace('@', '');
            }
        }
    });
});

// Keyboard shortcuts
document.addEventListener('keydown', function(e) {
    // Escape key to cancel forms
    if (e.key === 'Escape') {
        document.querySelectorAll('.cancel-btn, .cancel-add-btn').forEach(btn => {
            if (btn.closest('.rede-edit-form, .rede-add-form').style.display !== 'none') {
                btn.click();
            }
        });
    }
});
</script>
{% endblock %}