{% extends "base.html" %}

{% block title %}Gerenciar Membros - Lumiar{% endblock %}

{% block extra_css %}
<style>
    .admin-container {
        padding: 2rem 0;
        background: #f8fafc;
        min-height: calc(100vh - 80px);
    }

    .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 1rem;
    }

    /* Page Header */
    .page-header {
        text-align: center;
        margin-bottom: 3rem;
        padding: 2rem;
        background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%);
        color: white;
        border-radius: 1rem;
        box-shadow: 0 10px 25px -5px rgba(124, 58, 237, 0.3);
        position: relative;
        overflow: hidden;
    }

    .page-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="2" fill="rgba(255,255,255,0.1)"/></svg>') repeat;
        background-size: 20px 20px;
        animation: float 20s ease-in-out infinite;
    }

    @keyframes float {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-10px); }
    }

    .page-header h1 {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.75rem;
        position: relative;
        z-index: 1;
    }

    .page-header p {
        font-size: 1.1rem;
        opacity: 0.9;
        margin: 0;
        position: relative;
        z-index: 1;
    }

    /* Admin Toolbar */
    .admin-toolbar {
        display: grid;
        grid-template-columns: 1fr auto auto;
        gap: 1rem;
        margin-bottom: 2rem;
        padding: 1.5rem;
        background: white;
        border-radius: 1rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        border: 1px solid #e5e7eb;
        align-items: center;
    }

    .search-box {
        position: relative;
        max-width: 400px;
    }

    .search-box i {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: #6b7280;
        font-size: 1rem;
    }

    .search-box .form-control {
        padding-left: 2.5rem;
    }

    .filter-actions {
        display: flex;
        gap: 1rem;
        align-items: center;
    }

    .form-control {
        padding: 0.75rem 1rem;
        border: 2px solid #e5e7eb;
        border-radius: 0.5rem;
        font-size: 0.95rem;
        transition: all 0.3s ease;
        background: #fafafa;
    }

    .form-control:focus {
        outline: none;
        border-color: #7c3aed;
        background: white;
        box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
    }

    /* Add Member Button */
    .add-member-btn {
        background: linear-gradient(135deg, #059669, #10b981);
        color: white;
        border: none;
        padding: 0.75rem 1.5rem;
        border-radius: 0.5rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        text-decoration: none;
    }

    .add-member-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(5, 150, 105, 0.4);
        color: white;
        text-decoration: none;
    }

    /* Table Wrapper */
    .table-wrapper {
        background: white;
        border-radius: 1rem;
        overflow: hidden;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        border: 1px solid #e5e7eb;
        margin-bottom: 2rem;
    }

    .admin-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.9rem;
    }

    .admin-table thead {
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
    }

    .admin-table th {
        padding: 1.25rem 1rem;
        text-align: left;
        font-weight: 700;
        color: #374151;
        border-bottom: 2px solid #e5e7eb;
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .admin-table td {
        padding: 1rem;
        border-bottom: 1px solid #f3f4f6;
        vertical-align: middle;
    }

    .member-row {
        transition: all 0.3s ease;
    }

    .member-row:hover {
        background: #fafafa;
        transform: scale(1.001);
    }

    .member-row:last-child td {
        border-bottom: none;
    }

    /* Member Info */
    .member-info {
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .member-avatar {
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, #7c3aed, #a855f7);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 1rem;
        text-transform: uppercase;
    }

    .member-details strong {
        color: #1f2937;
        font-weight: 600;
    }

    /* Badges */
    .badge {
        padding: 0.375rem 0.75rem;
        border-radius: 0.5rem;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
    }

    .badge-primary {
        background: #ddd6fe;
        color: #6b46c1;
    }

    .badge-success {
        background: #d1fae5;
        color: #065f46;
    }

    .badge-danger {
        background: #fee2e2;
        color: #991b1b;
    }

    .badge-warning {
        background: #fef3c7;
        color: #92400e;
    }

    .badge-info {
        background: #dbeafe;
        color: #1e40af;
    }

    /* Action Buttons */
    .action-buttons {
        display: flex;
        gap: 0.5rem;
    }

    .btn {
        padding: 0.5rem 0.75rem;
        border: none;
        border-radius: 0.375rem;
        font-weight: 600;
        font-size: 0.8rem;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.25rem;
        border: 2px solid transparent;
    }

    .btn-sm {
        padding: 0.375rem 0.5rem;
        font-size: 0.75rem;
    }

    .btn-outline {
        background: transparent;
        color: #6b7280;
        border-color: #d1d5db;
    }

    .btn-outline:hover {
        background: #f9fafb;
        border-color: #7c3aed;
        color: #7c3aed;
    }

    .btn-primary {
        background: linear-gradient(135deg, #7c3aed, #a855f7);
        color: white;
    }

    .btn-primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(124, 58, 237, 0.4);
    }

    .btn-danger {
        background: #dc2626;
        color: white;
    }

    .btn-danger:hover {
        background: #b91c1c;
        transform: translateY(-1px);
    }

    .btn-success {
        background: #059669;
        color: white;
    }

    .btn-success:hover {
        background: #047857;
        transform: translateY(-1px);
    }

    /* Pagination */
    .pagination {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 0.5rem;
        margin-top: 2rem;
    }

    .page-item {
        padding: 0.75rem 1rem;
        border: 2px solid #e5e7eb;
        border-radius: 0.5rem;
        text-decoration: none;
        color: #6b7280;
        font-weight: 600;
        transition: all 0.3s ease;
        background: white;
    }

    .page-item:hover {
        border-color: #7c3aed;
        color: #7c3aed;
        text-decoration: none;
        transform: translateY(-1px);
    }

    .page-item.active {
        background: linear-gradient(135deg, #7c3aed, #a855f7);
        border-color: #7c3aed;
        color: white;
    }

    /* Stats Cards */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .stat-card {
        background: white;
        padding: 1.5rem;
        border-radius: 1rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        border: 1px solid #e5e7eb;
        text-align: center;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #7c3aed, #a855f7, #c084fc);
    }

    .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 15px rgba(124, 58, 237, 0.2);
    }

    .stat-number {
        font-size: 2rem;
        font-weight: 700;
        color: #1f2937;
        margin-bottom: 0.5rem;
    }

    .stat-label {
        color: #6b7280;
        font-size: 0.9rem;
        text-transform: uppercase;
        font-weight: 600;
        letter-spacing: 0.05em;
    }

    /* Loading State */
    .loading {
        opacity: 0.6;
        pointer-events: none;
        position: relative;
    }

    .loading::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 16px;
        height: 16px;
        margin: -8px 0 0 -8px;
        border: 2px solid #7c3aed;
        border-top-color: transparent;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 4rem 2rem;
        color: #6b7280;
    }

    .empty-state i {
        font-size: 4rem;
        color: #d1d5db;
        margin-bottom: 1rem;
    }

    .empty-state p {
        font-size: 1.1rem;
        margin: 0 0 1.5rem 0;
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {
        .admin-container {
            padding: 1rem 0;
            min-height: calc(100vh - 160px);
        }

        .container {
            padding: 0 0.5rem;
        }

        .page-header {
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .page-header h1 {
            font-size: 1.75rem;
            flex-direction: column;
            gap: 0.5rem;
        }

        .admin-toolbar {
            grid-template-columns: 1fr;
            gap: 1rem;
        }

        .filter-actions {
            justify-content: stretch;
        }

        .filter-actions select,
        .add-member-btn {
            flex: 1;
            justify-content: center;
        }

        .table-wrapper {
            overflow-x: auto;
        }

        .admin-table {
            min-width: 800px;
        }

        .admin-table th,
        .admin-table td {
            padding: 0.75rem 0.5rem;
        }

        .stats-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @media (max-width: 480px) {
        .stats-grid {
            grid-template-columns: 1fr;
        }

        .action-buttons {
            flex-direction: column;
        }

        .member-info {
            flex-direction: column;
            text-align: center;
            gap: 0.5rem;
        }
    }

    /* Bulk Actions */
    .bulk-actions {
        padding: 1rem;
        background: #f8fafc;
        border-bottom: 1px solid #e5e7eb;
        display: none;
        align-items: center;
        gap: 1rem;
    }

    .bulk-actions.active {
        display: flex;
    }

    .bulk-checkbox {
        margin-right: 0.5rem;
    }

    /* Filter Tags */
    .filter-tags {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
        margin-bottom: 1rem;
    }

    .filter-tag {
        background: #e0e7ff;
        color: #3730a3;
        padding: 0.25rem 0.75rem;
        border-radius: 1rem;
        font-size: 0.8rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 0.25rem;
    }

    .filter-tag button {
        background: none;
        border: none;
        color: #3730a3;
        cursor: pointer;
        padding: 0;
        margin-left: 0.25rem;
    }

    /* Export Button */
    .export-btn {
        background: linear-gradient(135deg, #1e40af, #3b82f6);
        color: white;
        border: none;
        padding: 0.75rem 1.5rem;
        border-radius: 0.5rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        text-decoration: none;
    }

    .export-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(30, 64, 175, 0.4);
        color: white;
        text-decoration: none;
    }
</style>
{% endblock %}

{% block content %}
<div class="admin-container">
    <div class="container">
        <div class="page-header">
            <h1>
                <i class="fas fa-users"></i>
                <span>Gerenciar Membros</span>
            </h1>
            <p>Administre todos os membros e usu√°rios da plataforma</p>
        </div>

        <!-- Stats Overview -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalMembros">{{ membros.total if membros else 0 }}</div>
                <div class="stat-label">Total de Membros</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="membrosAtivos">--</div>
                <div class="stat-label">Membros Ativos</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="novosEsseMes">--</div>
                <div class="stat-label">Novos Este M√™s</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="adminCount">--</div>
                <div class="stat-label">Administradores</div>
            </div>
        </div>

        <!-- Filters & Search Toolbar -->
        <div class="admin-toolbar">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input 
                    type="text" 
                    id="searchInput" 
                    class="form-control" 
                    placeholder="Pesquisar por nome, email ou cargo..."
                >
            </div>
            <div class="filter-actions">
                <select id="statusFilter" class="form-control">
                    <option value="">Todos os Status</option>
                    <option value="ativo">‚úÖ Ativo</option>
                    <option value="inativo">‚ùå Inativo</option>
                </select>
                <select id="cargoFilter" class="form-control">
                    <option value="">Todos os Cargos</option>
                    <option value="Administrador">üëë Administrador</option>
                    <option value="Membro">üë§ Membro</option>
                    <option value="Moderador">üõ°Ô∏è Moderador</option>
                </select>
            </div>
            <div style="display: flex; gap: 0.5rem;">
                <button class="export-btn" id="exportBtn">
                    <i class="fas fa-file-export"></i> Exportar
                </button>
                <button class="add-member-btn" id="addMemberBtn">
                    <i class="fas fa-user-plus"></i> Adicionar Membro
                </button>
            </div>
        </div>

        <!-- Active Filters Display -->
        <div class="filter-tags" id="filterTags" style="display: none;"></div>

        <!-- Members Table -->
        <div class="table-wrapper">
            <!-- Bulk Actions Bar -->
            <div class="bulk-actions" id="bulkActions">
                <input type="checkbox" class="bulk-checkbox" id="selectAll">
                <span id="selectedCount">0 selecionados</span>
                <button class="btn btn-sm btn-danger" id="bulkDelete">
                    <i class="fas fa-trash"></i> Deletar Selecionados
                </button>
                <button class="btn btn-sm btn-outline" id="bulkExport">
                    <i class="fas fa-download"></i> Exportar Selecionados
                </button>
            </div>

            {% if membros and membros.items %}
                <table class="admin-table" id="membersTable">
                    <thead>
                        <tr>
                            <th style="width: 40px;">
                                <input type="checkbox" id="selectAllHeader">
                            </th>
                            <th>üë§ Membro</th>
                            <th>üìß Email</th>
                            <th>üíº Cargo</th>
                            <th>üè¢ Departamento</th>
                            <th>üìä Status</th>
                            <th>üìÖ Criado em</th>
                            <th>üîß A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for membro in membros.items %}
                            <tr class="member-row" 
                                data-status="{% if membro.ativo %}ativo{% else %}inativo{% endif %}"
                                data-cargo="{{ membro.cargo or '' }}"
                                data-member-id="{{ membro.id }}">
                                <td>
                                    <input type="checkbox" class="member-checkbox" value="{{ membro.id }}">
                                </td>
                                <td>
                                    <div class="member-info">
                                        <div class="member-avatar" style="background: linear-gradient(135deg, {{ ['#7c3aed', '#059669', '#dc2626', '#f59e0b', '#3b82f6'][loop.index0 % 5] }}, {{ ['#a855f7', '#10b981', '#ef4444', '#fbbf24', '#60a5fa'][loop.index0 % 5] }});">
                                            {{ membro.nome[0].upper() if membro.nome else '?' }}
                                        </div>
                                        <div class="member-details">
                                            <strong>{{ membro.nome or 'Nome n√£o informado' }}</strong>
                                            {% if membro.ultimo_acesso %}
                                                <br><small style="color: #6b7280;">√öltimo acesso: {{ membro.ultimo_acesso.strftime('%d/%m/%Y %H:%M') }}</small>
                                            {% endif %}
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <code style="background: #f3f4f6; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.85rem;">{{ membro.email }}</code>
                                    {% if membro.email_verificado %}
                                        <i class="fas fa-check-circle" style="color: #059669; margin-left: 0.25rem;" title="Email verificado"></i>
                                    {% else %}
                                        <i class="fas fa-exclamation-triangle" style="color: #f59e0b; margin-left: 0.25rem;" title="Email n√£o verificado"></i>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if membro.cargo == 'Administrador' %}
                                        <span class="badge badge-danger">
                                            <i class="fas fa-crown"></i> {{ membro.cargo }}
                                        </span>
                                    {% elif membro.cargo == 'Moderador' %}
                                        <span class="badge badge-warning">
                                            <i class="fas fa-shield-alt"></i> {{ membro.cargo }}
                                        </span>
                                    {% elif membro.cargo %}
                                        <span class="badge badge-primary">
                                            <i class="fas fa-user"></i> {{ membro.cargo }}
                                        </span>
                                    {% else %}
                                        <span class="badge" style="background: #f3f4f6; color: #6b7280;">N/A</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {{ membro.departamento or '-' }}
                                </td>
                                <td>
                                    {% if membro.ativo %}
                                        <span class="badge badge-success">
                                            <i class="fas fa-check-circle"></i> Ativo
                                        </span>
                                    {% else %}
                                        <span class="badge badge-danger">
                                            <i class="fas fa-times-circle"></i> Inativo
                                        </span>
                                    {% endif %}
                                </td>
                                <td>
                                    <small style="font-family: monospace;">{{ membro.data_criacao.strftime('%d/%m/%Y') }}</small>
                                    <br><small style="color: #6b7280;">{{ membro.data_criacao.strftime('%H:%M') }}</small>
                                </td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn btn-sm btn-outline edit-btn" 
                                                data-member-id="{{ membro.id }}" 
                                                title="Editar Membro">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-sm btn-primary view-btn" 
                                                data-member-id="{{ membro.id }}" 
                                                title="Ver Detalhes">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        {% if membro.cargo != 'Administrador' or current_user.id != membro.id %}
                                            <button class="btn btn-sm btn-danger delete-btn" 
                                                    data-member-id="{{ membro.id }}"
                                                    data-member-name="{{ membro.nome }}" 
                                                    title="Deletar Membro">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        {% endif %}
                                    </div>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <div class="empty-state">
                    <i class="fas fa-users-slash"></i>
                    <p>Nenhum membro encontrado</p>
                    <button class="btn btn-primary" id="addFirstMember">
                        <i class="fas fa-user-plus"></i> Adicionar Primeiro Membro
                    </button>
                </div>
            {% endif %}
        </div>

        <!-- Pagination -->
        {% if membros and membros.pages > 1 %}
            <div class="pagination">
                {% if membros.has_prev %}
                    <a href="{{ url_for('admin_membros', pagina=membros.prev_num) }}" class="page-item">
                        <i class="fas fa-chevron-left"></i> Anterior
                    </a>
                {% endif %}
                
                {% for page_num in membros.iter_pages() %}
                    {% if page_num %}
                        {% if page_num == membros.page %}
                            <span class="page-item active">{{ page_num }}</span>
                        {% else %}
                            <a href="{{ url_for('admin_membros', pagina=page_num) }}" class="page-item">
                                {{ page_num }}
                            </a>
                        {% endif %}
                    {% else %}
                        <span class="page-item">...</span>
                    {% endif %}
                {% endfor %}

                {% if membros.has_next %}
                    <a href="{{ url_for('admin_membros', pagina=membros.next_num) }}" class="page-item">
                        Pr√≥ximo <i class="fas fa-chevron-right"></i>
                    </a>
                {% endif %}
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// DOM Elements
const searchInput = document.getElementById('searchInput');
const statusFilter = document.getElementById('statusFilter');
const cargoFilter = document.getElementById('cargoFilter');
const filterTags = document.getElementById('filterTags');
const bulkActions = document.getElementById('bulkActions');
const selectAllHeader = document.getElementById('selectAllHeader');
const memberCheckboxes = document.querySelectorAll('.member-checkbox');

// Initialize stats
function updateStats() {
    const allRows = document.querySelectorAll('.member-row');
    const activeMembers = document.querySelectorAll('.member-row[data-status="ativo"]').length;
    const adminMembers = document.querySelectorAll('.member-row[data-cargo="Administrador"]').length;
    
    document.getElementById('membrosAtivos').textContent = activeMembers;
    document.getElementById('adminCount').textContent = adminMembers;
    
    // Simulate new members this month (would come from backend)
    document.getElementById('novosEsseMes').textContent = Math.floor(allRows.length * 0.2);
}

// Search functionality
function performSearch() {
    const searchTerm = searchInput.value.toLowerCase().trim();
    const statusValue = statusFilter.value;
    const cargoValue = cargoFilter.value;
    
    let visibleCount = 0;
    
    document.querySelectorAll('.member-row').forEach(row => {
        const text = row.textContent.toLowerCase();
        const status = row.dataset.status;
        const cargo = row.dataset.cargo;
        
        const matchesSearch = !searchTerm || text.includes(searchTerm);
        const matchesStatus = !statusValue || status === statusValue;
        const matchesCargo = !cargoValue || cargo === cargoValue;
        
        if (matchesSearch && matchesStatus && matchesCargo) {
            row.style.display = '';
            visibleCount++;
        } else {
            row.style.display = 'none';
        }
    });
    
    updateFilterTags();
    updateVisibleCount(visibleCount);
}

// Update filter tags display
function updateFilterTags() {
    const tags = [];
    
    if (searchInput.value.trim()) {
        tags.push({ type: 'search', text: `Busca: "${searchInput.value.trim()}"`, clear: () => { searchInput.value = ''; } });
    }
    
    if (statusFilter.value) {
        const statusText = statusFilter.options[statusFilter.selectedIndex].text;
        tags.push({ type: 'status', text: `Status: ${statusText}`, clear: () => { statusFilter.value = ''; } });
    }
    
    if (cargoFilter.value) {
        const cargoText = cargoFilter.options[cargoFilter.selectedIndex].text;
        tags.push({ type: 'cargo', text: `Cargo: ${cargoText}`, clear: () => { cargoFilter.value = ''; } });
    }
    
    if (tags.length > 0) {
        filterTags.style.display = 'flex';
        filterTags.innerHTML = tags.map(tag => `
            <span class="filter-tag">
                ${tag.text}
                <button onclick="clearFilter('${tag.type}')" title="Remover filtro">√ó</button>
            </span>
        `).join('');
    } else {
        filterTags.style.display = 'none';
    }
}

// Clear specific filter
function clearFilter(type) {
    switch(type) {
        case 'search': searchInput.value = ''; break;
        case 'status': statusFilter.value = ''; break;
        case 'cargo': cargoFilter.value = ''; break;
    }
    performSearch();
}

// Update visible count
function updateVisibleCount(count) {
    const totalCount = document.querySelectorAll('.member-row').length;
    if (count < totalCount) {
        // Could add a "showing X of Y" indicator
    }
}

// Bulk selection functionality
function updateBulkActions() {
    const checkedBoxes = document.querySelectorAll('.member-checkbox:checked');
    const selectedCount = checkedBoxes.length;
    
    if (selectedCount > 0) {
        bulkActions.classList.add('active');
        document.getElementById('selectedCount').textContent = `${selectedCount} selecionado${selectedCount > 1 ? 's' : ''}`;
    } else {
        bulkActions.classList.remove('active');
    }
    
    // Update select all checkbox state
    const totalVisible = document.querySelectorAll('.member-row:not([style*="display: none"]) .member-checkbox').length;
    const checkedVisible = document.querySelectorAll('.member-row:not([style*="display: none"]) .member-checkbox:checked').length;
    
    selectAllHeader.indeterminate = checkedVisible > 0 && checkedVisible < totalVisible;
    selectAllHeader.checked = checkedVisible === totalVisible && totalVisible > 0;
}

// Show alert
function showAlert(message, type = 'success') {
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert alert-${type}`;
    alertDiv.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
        padding: 1rem 1.5rem;
        border-radius: 0.5rem;
        color: white;
        font-weight: 600;
        animation: slideIn 0.3s ease;
        background: ${type === 'success' ? '#059669' : type === 'error' ? '#dc2626' : '#f59e0b'};
    `;
    alertDiv.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'times-circle' : 'exclamation-triangle'}"></i>
        ${message}
    `;
    
    document.body.appendChild(alertDiv);
    
    setTimeout(() => {
        alertDiv.remove();
    }, 4000);
}

// Event Listeners
searchInput.addEventListener('input', performSearch);
statusFilter.addEventListener('change', performSearch);
cargoFilter.addEventListener('change', performSearch);

// Select all functionality
selectAllHeader.addEventListener('change', function() {
    const visibleCheckboxes = document.querySelectorAll('.member-row:not([style*="display: none"]) .member-checkbox');
    visibleCheckboxes.forEach(checkbox => {
        checkbox.checked = this.checked;
    });
    updateBulkActions();
});

// Individual checkbox listeners
memberCheckboxes.forEach(checkbox => {
    checkbox.addEventListener('change', updateBulkActions);
});

// Action button listeners
document.querySelectorAll('.edit-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        const memberId = this.dataset.memberId;
        showAlert(`Fun√ß√£o de edi√ß√£o para membro ${memberId} ser√° implementada`, 'info');
        // TODO: Open edit modal or redirect to edit page
    });
});

document.querySelectorAll('.view-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        const memberId = this.dataset.memberId;
        window.open(`/admin/membros/${memberId}/detalhes`, '_blank');
    });
});

document.querySelectorAll('.delete-btn').forEach(btn => {
    btn.addEventListener('click', async function() {
        const memberId = this.dataset.memberId;
        const memberName = this.dataset.memberName;
        
        if (!confirm(`Tem certeza que deseja deletar o membro "${memberName}"?\n\nEsta a√ß√£o n√£o pode ser desfeita.`)) return;
        
        btn.classList.add('loading');
        
        try {
            const response = await fetch(`/admin/membros/${memberId}/deletar`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                }
            });
            
            if (response.ok) {
                showAlert(`Membro "${memberName}" deletado com sucesso`, 'success');
                // Remove row with animation
                const row = btn.closest('.member-row');
                row.style.transition = 'all 0.3s ease';
                row.style.transform = 'translateX(-100%)';
                row.style.opacity = '0';
                
                setTimeout(() => {
                    row.remove();
                    updateStats();
                    performSearch(); // Refresh visible count
                }, 300);
            } else {
                const data = await response.json();
                showAlert(`Erro: ${data.mensagem || 'Erro desconhecido'}`, 'error');
            }
        } catch (error) {
            console.error('Erro:', error);
            showAlert('Erro de conex√£o. Tente novamente.', 'error');
        } finally {
            btn.classList.remove('loading');
        }
    });
});

// Export functionality
document.getElementById('exportBtn')?.addEventListener('click', function() {
    const visibleRows = document.querySelectorAll('.member-row:not([style*="display: none"])');
    showAlert(`Exportando ${visibleRows.length} membros...`, 'success');
    
    // TODO: Implement actual export functionality
    setTimeout(() => {
        showAlert('Exporta√ß√£o conclu√≠da! Arquivo baixado.', 'success');
    }, 2000);
});

// Add member functionality
document.getElementById('addMemberBtn')?.addEventListener('click', function() {
    window.location.href = '/admin/membros/adicionar';
});

document.getElementById('addFirstMember')?.addEventListener('click', function() {
    window.location.href = '/admin/membros/adicionar';
});

// Bulk delete
document.getElementById('bulkDelete')?.addEventListener('click', async function() {
    const checkedBoxes = document.querySelectorAll('.member-checkbox:checked');
    const selectedIds = Array.from(checkedBoxes).map(cb => cb.value);
    
    if (!confirm(`Tem certeza que deseja deletar ${selectedIds.length} membro(s) selecionado(s)?\n\nEsta a√ß√£o n√£o pode ser desfeita.`)) return;
    
    this.classList.add('loading');
    
    try {
        const response = await fetch('/admin/membros/bulk-delete', {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ ids: selectedIds })
        });
        
        if (response.ok) {
            showAlert(`${selectedIds.length} membro(s) deletado(s) com sucesso`, 'success');
            setTimeout(() => location.reload(), 1000);
        } else {
            const data = await response.json();
            showAlert(`Erro: ${data.mensagem || 'Erro desconhecido'}`, 'error');
        }
    } catch (error) {
        console.error('Erro:', error);
        showAlert('Erro de conex√£o. Tente novamente.', 'error');
    } finally {
        this.classList.remove('loading');
    }
});

// Initialize
updateStats();
updateBulkActions();

// Auto-refresh stats every 30 seconds
setInterval(updateStats, 30000);
</script>

<style>
@keyframes slideIn {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}
</style>
{% endblock %}